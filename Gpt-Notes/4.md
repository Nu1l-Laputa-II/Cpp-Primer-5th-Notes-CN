# 第4章 表达式 - 总结笔记

---

## 1. 基础概念

### 1.1 表达式（Expression）
- 表达式由运算对象（operand）和运算符（operator）组成，对表达式求值可得一个结果。
- 最简单的表达式： 字面值和变量，其结果就是它们的值。

### 1.2 运算符分类
1. 一元运算符（unary operator）： 作用于单个运算对象。
2. 二元运算符（binary operator）： 作用于两个运算对象。
3. 三元运算符（ternary operator）： 作用于三个运算对象，仅有条件运算符 `?:`。

### 1.3 左值与右值
- 左值（lvalue）： 表示对象的地址，可出现在赋值符号的左侧。
- 右值（rvalue）： 表示对象的值，不可作为赋值的目标。
  ```cpp
  int x = 10;    // x 是左值，10 是右值
  int *p = &x;   // &x 是一个右值，表示 x 的地址
  ```

### 1.4 优先级与结合律
- 优先级： 决定运算符的组合顺序。
- 结合律： 当多个运算符优先级相同时，结合律决定计算顺序（左结合或右结合）。
- 括号： 使用括号强制优先级，可确保运算顺序符合逻辑。

---

## 2. 算术运算符

| 运算符 | 功能       | 用法         |
|------------|----------------|------------------|
| `+`        | 一元正号       | `+expr`          |
| `-`        | 一元负号       | `-expr`          |
| `*`        | 乘法           | `expr * expr`    |
| `/`        | 除法           | `expr / expr`    |
| `%`        | 取模（余数）   | `expr % expr`    |
| `+`        | 加法           | `expr + expr`    |
| `-`        | 减法           | `expr - expr`    |

- 注意事项：
  1. 整数除法（C++11+）： 结果向 0 取整（去掉小数部分）。
  2. 取模 `%`： 仅适用于整数类型。

---

## 3. 逻辑和关系运算符

| 运算符 | 功能         | 用法            |
|------------|------------------|---------------------|
| `&&`       | 逻辑与           | `expr1 && expr2`    |
| `|`|`       | 逻辑或           | `expr1 || expr2`    |
| `!`        | 逻辑非           | `!expr`             |
| `<`        | 小于             | `expr1 < expr2`     |
| `<=`       | 小于等于         | `expr1 <= expr2`    |
| `>`        | 大于             | `expr1 > expr2`     |
| `>=`       | 大于等于         | `expr1 >= expr2`    |
| `==`       | 等于             | `expr1 == expr2`    |
| `!=`       | 不等于           | `expr1 != expr2`    |

- 短路求值（short-circuit evaluation）：
  1. 逻辑与 `&&`： 左侧为假时，右侧不再计算。
  2. 逻辑或 `||`： 左侧为真时，右侧不再计算。

---

## 4. 赋值运算符

| 运算符 | 功能            | 用法        |
|------------|---------------------|-----------------|
| `=`        | 赋值                | `var = value`   |
| `+=`       | 加赋值              | `var += value`  |
| `-=`       | 减赋值              | `var -= value`  |
| `*=`       | 乘赋值              | `var *= value`  |
| `/=`       | 除赋值              | `var /= value`  |
| `%=`       | 取模赋值            | `var %= value`  |

- 特点：
  - 左结合律： 从右到左求值。
    ```cpp
    int x, y;
    x = y = 10; // 等价于 x = (y = 10)
    ```
  - 支持列表赋值： 使用花括号初始化列表。
    ```cpp
    vector<int> vec;
    vec = {1, 2, 3}; // 列表赋值
    ```

---

## 5. 递增与递减运算符

| 运算符 | 功能         | 用法     |
|------------|------------------|--------------|
| `++`       | 自增             | `++var` 或 `var++` |
| `--`       | 自减             | `--var` 或 `var--` |

- 前置版本（`++i` 或 `--i`）：
  - 先改变值，再返回改变后的值。
- 后置版本（`i++` 或 `i--`）：
  - 先返回原值，再改变值。
  ```cpp
  int i = 0;
  int j = ++i;  // j = 1, i = 1
  int k = i++;  // k = 1, i = 2
  ```

- 建议： 如果不需要原始值，优先使用前置版本（效率更高）。

---

## 6. 条件运算符（`?:`）

| 运算符 | 功能                | 用法                 |
|------------|-------------------------|--------------------------|
| `?:`       | 条件运算（三元运算符） | `cond ? expr1 : expr2`   |

- 功能：
  - 条件 `cond` 为真时，返回 `expr1`；
  - 条件 `cond` 为假时，返回 `expr2`。

- 结果类型：
  - 若 `expr1` 和 `expr2` 是左值，结果为左值；
  - 否则，结果为右值。

- 示例：
  ```c++
  int x = 5, y = 10;
  int max = (x > y) ? x : y;  // max = 10
  ```

---

## 7. 位运算符

| 运算符 | 功能         | 用法          |
|------------|------------------|-------------------|
| `~`        | 按位取反         | `~expr`           |
| `<<`       | 左移             | `expr << bits`    |
| `>>`       | 右移             | `expr >> bits`    |
| `&`        | 按位与           | `expr & expr`     |
| `|`        | 按位或           | `expr | expr`     |
| `^`        | 按位异或         | `expr ^ expr`     |

- 注意事项：
  - 推荐操作无符号类型： 避免符号位的不确定性。
  - 左移 `<<`： 在右侧补 0。
  - 右移 `>>`：
    - 对无符号数：左侧补 0。
    - 对有符号数：可能补符号位或 0，具体行为依赖实现。

---

## 8. `sizeof` 运算符

- 返回对象或类型所占字节数，结果类型为 `size_t`。
- 常见行为：
  - 对 `char`，返回 `1`。
  - 对数组，返回整个数组的大小（包括所有元素）。
  - 对指针，返回指针本身的大小。
  ```c++
  int arr[10];
  cout << sizeof(arr) / sizeof(arr[0]); // 输出数组元素个数
  ```

---

## 9. 类型转换

### 9.1 隐式转换
- 编译器自动执行，常见规则：
  1. 算术转换： 小类型转换为较大类型（如 `char` 转 `int`）。
  2. 指针转换：
     - `nullptr` 可转换为任意指针类型。
     - 非常量指针可转换为常量指针。

### 9.2 显式转换（强制转换）
- 显式指定类型转换，形式如下：
  ```c++
  cast-name<type>(expression);
  ```
- 命名转换方式：
  1. `static_cast`： 常规转换。
  2. `const_cast`： 改变 `const` 属性。
  3. `reinterpret_cast`： 位模式重新解释。
  4. `dynamic_cast`： 支持运行时类型检查。

- 示例：
  ```c++
  double d = 3.14;
  int i = static_cast<int>(d);  // 转换为 int
  ```

---

## 10. 逗号运算符

- 形式：`expr1, expr2`。
- 功能： 从左到右依次求值，返回最后一个表达式的值。
- 常用场景： `for` 循环中多个变量的更新。
  ```c++
  for (int i = 0, j = 10; i < j; ++i, --j) {
      cout << i << " " << j << endl;
  }
  ```